---
title: "10 - Mapas interativos: o pacote `leaflet`"
---

|       Não só de gráficos vive o `R` (ou o Ensino, de modo geral). O pacote `leaflet`, por exemplo, permite gerar *interatividade cartográfica,* ou seja, uma *geovisualização* de dados retratados em um mapa. Isso pode ser particularmente útil quando se deseja uma rápida visualização de alguma informação diretamente num mapa cartográfico, como distribuição de renda, informações de saúde e moléstias, áreas de desmatamento, de queimadas, etc. Exemplos variados de bancos de dados desse tipo são acessíveis, por exemplo, pelos *sites* do *IBGE*, *DATA SUS*, *Portal de Dados Abertos do Governo Brasileiro*, entre vários.

|       Para tal *geocomputação* existem diversos pacotes do `R` direcionados, como [`ggiraph`](https://cran.r-project.org/web/packages/ggiraph/index.html), [`highcharter`](https://cran.r-project.org/web/packages/highcharter/index.html), e [`leaflet`](https://cran.r-project.org/web/packages/leaflet/index.html), esse último a ser ilustrado neste capítulo.

|       Basicamente, o `leaflet` atua produzindo *mapas interativos* com auxílio de *JavaScript* e da biblioteca *htmlwidgets*, e que podem renderizar tanto dentro do *RStudio*, como em páginas *HTML* separadas. Essa biblioteca foi escolhida por sua facilidade de uso, e por está inserida em diversas fontes de dados na internete, como o [MapBiomas da Plataforma Brasil](https://brasil.mapbiomas.org/).

|       Uma **observação se faz necessária** para o uso básico do `leaflet`. Para sobrepor informações em regiões cartográficas, é necessário que o banco de dados possua as informações de *latitude e longitude* para cada elemento que constará do mapa.

\
\## Estabelecendo coordenadas

|       Uma ação inicial para uso do pacote `leaflet` envolve estabelecer as coordenadas geográficas para uma visão inicial do marcador no gráfico. Para isso é necessário os valores de latitude e longitude, bem como o nível de ampliação desejado. Mas é simples. Veja abaixo um exemplo para o município de Cuiabá, MT.

```{r}
library(leaflet)
leaflet() %>%  # carrega-se o pacote
  addTiles() %>%  # adiciona-se as "peças" (tiles)
  setView(lng= -56.0949, lat= -15.5989, zoom = 4)
```

|       Veja que aparece no canto superior direito os níveis *+ e -* de ampliação, mas você pode usar também o botão de rolagem do *mouse*. Note também que, apesar de ter sido gerado um mapa do Brasil, não há menção do município de Cuiabá, como desejado. Isso deve-se ao nível de ampliação (*zoom*) selecionado, e à ausência de um *marcador*. Experimente variar para *5* o nível, e adicione um marcador, como segue:

```{r}
library(leaflet)
leaflet() %>%  # carrega-se o pacote
  addTiles() %>%  # adiciona-se as "peças" (tiles)
  setView(lng= -56.0949, lat= -15.5989, zoom = 5) %>% # adiciona-se as coordenadas desejadas e o nível de ampliação
  addMarkers(lng=-56.0949, lat=-15.5989)
```

|       Também é possível adicionar outras informações ao marcador, como algum dado específico, e um *link*, por exemplo:

```{r}
library(leaflet)
leaflet() %>%  # carrega-se o pacote
  addTiles() %>%  # adiciona-se as "peças" (tiles)
  setView(lng= -56.0949, lat= -15.5989, zoom = 5) %>% # adiciona-se as coordenadas desejadas e o nível de ampliação
  addMarkers(lng=-56.0949, lat=-15.5989,
             popup="<b>650.912 habitantes</b><br><a href='https://www.cuiaba.mt.gov.br/'>Município</a>") # adiciona-se informação e link ao marcador 
```

\

|       Basta clicar no marcador para acessar a informação e o *link*.

\

## Usando o `leaflet` com uma planilha contendo várias coordenadas

|       Ainda que seja legal a interatividade cartográfica mencionada acima faz mais sentido quando temos um conjunto de dados associados a cada coordenada geográfica, permitindo ilustrar-se uma quantidade maior de informações num mapa.

|       Para ilustrar isso vamos utilizar um levantamento de alguns aeroportos e aeródromos pelo Brasil. Para isso, carregue os dados que seguem transcrevendo o trecho de código abaixo para um *script*.

```{r}
dados_aero <-structure(list(aerodromo = c("Aero Agrícola Gaivota", "Aero Agrícola Sapezal", 
"Aeroagrícola Solo", "Aeroclube de Atibaia", "Aeroclube de Bento Gonçalves", 
"Aeroclube de Eldorado do Sul", "Aeroclube de Foz do Iguaçu", 
"Aeroclube de João Pessoa", "Aeroclube de Nova Iguaçu", "Aeroclube de Passo Fundo", 
"Aeroclube de Rio Negrinho", "Aeroclube de Rondônia", "Aeroclube de Santa Catarina", 
"Aeroclube São José do Rio Pardo", "Aeródomo Novo Aripuanã", 
"Aeródromo Aerocampo", "Aeródromo Aeroporto Regional da Zona da Mata", 
"Aeródromo Aero Rural", "Aeródromo Aero Z Ferrus", "Aeródromo Afonso Pena", 
"Aeródromo Agricenter", "Aeródromo Agrícola Rio Galhão", 
"Aeródromo Agropecuária Céu Aberto Ltda", "Aeródromo Agropecuária Nova Santana", 
"Aeródromo Agrosan", "Aeródromo Agrovale", "Aeródromo Aguinaldo Pereira Lima", 
"Aeródromo Alenquer", "Aeródromo Almerim", "Aeródromo Altamira", 
"Aeródromo Amambaí", "Aeródromo Amapá", "Aeródromo Anamoim", 
"Aeródromo André Maggi", "Aeródromo Ângelo Ponzoni", "Aeródromo Aparecida do Taboado", 
"Aeródromo Aparecido O. Silva", "Aeródromo Araguaiana", "Aeródromo Araguari", 
"Aerodromo Areia Branca", "Aeródromo Ariquemes", "Aeródromo Arraias", 
"Aeródromo Arroio Grande", "Aeródromo Associação Tocantinense de Aviação", 
"Aeródromo Auaris"), lat = c(-22.9805, -13.5511, -23.4471, -23.1281, 
-29.1473, -30.0507, -25.3696, -7.09217, -22.7461, -28.2509, -26.3207, 
-8.79415, -27.6116, -21.6473, -5.11774, -13.6365, -21.5131, -9.92088, 
0.993532, -25.5293, -22.6239, -10.4239, -9.50103, -10.1417, -11.3977, 
-9.50436, -23.6746, -1.91731, -1.47771, -3.25205, -23.1439, 2.07607, 
1.78498, -9.89865, -26.9995, -20.0891, -22.0691, -15.7092, -18.6679, 
-7.98825, -9.88046, -13.0259, -32.2293, -10.1824, 4.00087), long = c(-51.5425, 
-58.8603, -48.8665, -46.5747, -51.5411, -51.4434, -54.4707, -34.8417, 
-43.4642, -52.5168, -49.5219, -63.8574, -48.6732, -46.9282, -60.3651, 
-57.9038, -43.1735, -56.0051, -51.1208, -49.1748, -55.5691, -46.0765, 
-61.2744, -60.5479, -58.1215, -40.3698, -49.8155, -54.7218, -52.5825, 
-52.2553, -55.2077, -50.8597, -67.4055, -58.5819, -51.1401, -51.1478, 
-48.7067, -51.8377, -48.1903, -61.0506, -63.0471, -46.8838, -53.0561, 
-48.5455, -64.5043), uf = c("PR", "MT", "SP", "SP", "RS", "RS", 
"PR", "PB", "RJ", "RS", "SC", "RO", "SC", "SP", "AM", "MT", "MG", 
"MT", "AP", "PR", "MS", "TO", "MT", "MT", "MT", "BA", "PR", "PA", 
"PA", "PA", "MS", "AP", "AM", "MT", "SC", "MS", "SP", "MT", "MG", 
"AM", "RO", "TO", "RS", "TO", "RR")), class = "data.frame", row.names = c(NA, 
-45L))
```

|       Agora observe cada aeródromo e aeroclube no mapa, sem a necessidade de clique de *mouse*, apenas passando o mesmo sobre o mapa, com auxílio do código abaixo:

```{r}
library(htmltools) # carrega pacote para facilitar a visualização por "mouseover"
library(leaflet)
leaflet(dados_aero) %>% addTiles() %>%
  addMarkers(~long, ~lat, label = ~htmlEscape(aerodromo)) # adiciona os marcadores e associa aos nomes de cada aeródromo
```

## Referência do pacote:

-   [Geral](https://cran.r-project.org/web/packages/leaflet/index.html)
-   [Manual](https://cran.r-project.org/web/packages/leaflet/leaflet.pdf):
-   [Tutorial](https://leafletjs.com/examples.html)
